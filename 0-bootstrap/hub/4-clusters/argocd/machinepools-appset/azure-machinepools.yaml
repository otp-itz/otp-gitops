apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: azure-machinepoolls
spec:
  generators:
  - clusters:
      selector:
        matchLabels:
          cloud: Azure
  template:
    metadata:
      name: '{{name}}-storage'
    spec:
      project: clusters
      source:
        repoURL: https://github.com/otp-itz/otp-gitops-clusters.git
        path: machinepools
        helm:
          values: |
            cloudProvider:
              name: "azure" # aws, azure, ibmcloud or vsphere
              managed: false # for roks, aro, rosa set to true
            cloud:
              clusterName: {{ server }}
      destination:
        server: 'https://kubernetes.default.svc'
        namespace: '{{ server }}'